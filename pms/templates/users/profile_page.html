{% extends "./base_users.html" %} {% block root %}
<div class="h-dvh mx-2 my-2">
  <header class="flex justify-end text-black font-medium">
    {{ user.username }}
  </header>

  <div
    class="flex flex-col w-3/4 mx-auto bg-white shadow-lg rounded-lg p-6"
    x-data="{
        activeTab: '', // Tracks the current tab.
        data: [], // Stores the fetched data.
        updateData(event) {
            const response = JSON.parse(event.detail.xhr.responseText);
            this.data = response; 
        }
    }"
  >
    <nav class="flex w-full border-b-2 border-blue-500 rounded-t-md">
      {# organizations button #}
      <button
        class="flex-1 py-2 text-center hover:bg-blue-200 focus:bg-blue-300 transition-colors border-b-4"
        hx-get="{% url 'user_organizations' %}"
        hx-trigger="load, click"
        hx-target="this"
        hx-swap="none"
        @htmx:before-request="activeTab='organizations'"
        @htmx:after-request="updateData(event)"
        :class="{ 'border-blue-500': activeTab === 'organizations', 'border-transparent': activeTab !== 'organizations' }"
      >
        Organizations
      </button>
      {# projects button #}
      <button
        class="flex-1 py-2 text-center hover:bg-blue-200 focus:bg-blue-300 transition-colors border-b-4"
        hx-get=""
        hx-trigger="click"
        hx-target="this"
        hx-swap="none"
        @htmx:before-request="activeTab='projects'"
        @htmx:after-request="updateData(event)"
        :class="{ 'border-blue-500': activeTab === 'projects', 'border-transparent': activeTab !== 'projects' }"
      >
        Projects
      </button>
    </nav>

    <section class="w-full rounded-b-md p-4">
      {# only display if the user is on the 'organizations' tab #}
      <template x-if="activeTab === 'organizations'">
        <div>
          <div class="flex justify-end">
            {# link to create an organization #}
            <a
              href="{% url 'create_organization' %}"
              class="bg-white border border-gray-300 text-gray-700 px-1 py-2 mt-2 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-300"
            >
              Create an organization.</a
            >
          </div>
          <template x-if="data.length > 0">
            <ul class="space-y-2">
              <template x-for="org in data" :key="org.organization_id">
                <li
                  x-text="org.organization_name"
                  class="bg-white p-2 rounded-md shadow"
                ></li>
              </template>
            </ul>
          </template>
          <template x-if="data.length === 0">
            <p class="text-gray-600">
              You are currently not a member of any organization.
            </p>
          </template>
        </div>
      </template>

      {# only display if the user is on the 'projects' tab #}
      <template x-if="activeTab === 'projects'">
        <div>
          <template x-if="data.length > 0">
            <ul class="space-y-2">
              <template x-for="project in data" :key="project.id">
                <li
                  x-text="project.title"
                  class="bg-white p-2 rounded-md shadow"
                ></li>
              </template>
            </ul>
          </template>
          <template x-if="data.length === 0">
            <p class="text-gray-600">No active projects found.</p>
          </template>
        </div>
      </template>
    </section>
  </div>
</div>
{% endblock root %}
